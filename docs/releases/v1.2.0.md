# v1.2.0 - Streamlined Detection & Watch Mode

## ⚠️ Breaking Changes

- **Detection simplified**: MDX (Demucs) is now the only method - Spleeter and HQ Segment removed
- **Environment**: Migrated from Anaconda to standard Python venv (.venv)
- **Storage**: App data now in platform-standard locations (see v1.1.0 notes - no change from v1.1.0)

## What's New

### 🆕 v1.2.0-rc5 (Latest) - Flexible UI & Smart Startup

#### UI Enhancements
- **Resizable Panels**: Two dynamic splitters for complete layout control
  - **Main splitter**: Adjust song list vs. bottom panel ratio
  - **Waveform splitter**: Resize waveform vs. task/log panel
  - **Persistent positions**: Layout saved and restored between sessions (saved in `config.ini`)
  - **Flexible waveform**: No more fixed height - expand as much as you need
  - **Equal-height task/log**: Task queue and logs now share space evenly by default

#### Startup Experience
- **Smart "Don't Show Again" checkbox**: Auto-checked in these scenarios:
  - ✅ GPU Pack successfully installed and working (GPU mode)
  - ✅ No GPU hardware detected (CPU-only mode)
  - ⬜ Unchecked when GPU exists but Pack not installed (offers download)
- **Version display**: RC appendix (e.g., "v1.2.0-rc5") now shown in startup dialog

#### Configuration
- New config options in `config.ini`:
  - `main_splitter_pos`: Song list vs. bottom panel divider position
  - `second_splitter_pos`: Waveform vs. task/log divider position

---

### Watch Mode - Real-Time Monitoring
- **Auto-discover new songs** as you add them to watched folder
- **Smart file monitoring** using OS-native watchers (efficient, low CPU)
- **Configurable debouncing** (500ms default) prevents processing storms
- **Cache synchronization** keeps UI in sync with filesystem changes

### Multi-Song Tracking
- **Multi-entry gap info**: Folders with multiple txt files now track gap data per song independently
- **No cross-contamination** between songs sharing a folder

### UI Improvements
- **Waveform markers**: Dynamic overlay markers (playhead, gaps) instead of static images
- **Viewport lazy loading**: Smoother scrolling with large song lists
- **Window persistence**: Size and position saved between sessions
- **Better layout**: Action buttons repositioned for clearer workflow

### Developer & Quality
- **601 cross-platform tests** with automated CI/CD (including comprehensive runtime hook tests)
- **Type safety**: Fixed 56 type errors for better IDE support
- **GitHub Actions**: Automated builds for Windows/Linux/macOS
- **Code cleanup**: Removed feature flags, unified code paths, improved architecture
- **GPU Pack runtime hook**: Refactored with early exits, modular functions, and comprehensive test coverage for reliable PyInstaller builds

### Bug Fixes
- **Audio normalization**: Fixed Windows "Access Denied" errors with improved file locking
- **Config persistence**: Fixed config.ini reset during tests
- **Waveform accuracy**: Removed audio filter to preserve original amplitude
- **Cache versioning**: User prompt on upgrade to confirm re-scan
- **GPU Pack**: Improved compatibility and error handling
- **Worker queue**: Better cancellation and cleanup

## Upgrading from Previous Version

### From v1.1.0 or later

**No migration needed** - your data directory location hasn't changed since v1.1.0.

**Quick Steps:**
1. Download new version
2. Extract and run
3. Your existing config and cache will be used automatically

**Finding your data directory:**
- **Windows**: Press `Win+R`, type `%LOCALAPPDATA%\USDXFixGap`, press Enter
- **Linux**: `~/.local/share/USDXFixGap/`
- **macOS**: `~/Library/Application Support/USDXFixGap/`

### From source

```bash
# Windows
.\run.bat install

# Linux/macOS
./run.sh install
```

## FAQs

**What happened to Spleeter detection?**
It's been removed to support modern Python versions (3.12+). MDX (Demucs) provides better accuracy and performance. Your config will automatically switch to MDX.

**Where is my data stored now?**
Since v1.1.0, data is in platform-standard locations:
- Windows: `%LOCALAPPDATA%\USDXFixGap\`
- Linux: `~/.local/share/USDXFixGap/`
- macOS: `~/Library/Application Support/USDXFixGap/`

**What's Watch Mode?**
Enable it in the UI to automatically scan for new songs, update changed files, and keep your collection synchronized. Perfect for active song management!

**Can I customize the UI layout?**
Yes! As of RC5, you can resize all panels by dragging the splitter bars. Your layout preferences are saved automatically.

**Why does startup dialog auto-check "Don't show again"?**
If your system is fully configured (GPU working) or has no GPU hardware (CPU-only), there's nothing to configure, so it auto-checks for convenience. You can still uncheck it if you prefer.

## 🙏 Thanks

Thanks to all contributors, testers, and users for valuable feedback that made this release possible!

---

## 📥 Installation

### Windows
Download `usdxfixgap-v1.2.0-windows.zip` (or latest RC), extract, and run `usdxfixgap.exe`.

**Note**: Windows Defender may show a false positive warning (common with PyInstaller apps). The source code is open for inspection.

### Linux
```bash
tar -xzf usdxfixgap-v1.2.0-linux.tar.gz
./usdxfixgap
```

### macOS
```bash
tar -xzf usdxfixgap-v1.2.0-macos.tar.gz
./usdxfixgap
```
