# v2.0.0 - Venv Migration, MDX-Only Detection, GPU Pack Robustness

### ⚠️ Breaking Changes

- **Environment**: Migrated from Anaconda to standard Python venv (.venv); first run creates environment automatically
- **Detection**: Removed Spleeter and HQ Segment methods; MDX (Demucs) is now the only provider
- **Storage**: App data moved to platform-standard directories (Windows: %LOCALAPPDATA%, Linux: ~/.local/share, macOS: ~/Library/Application Support)
- **Config**: Removed legacy `DefaultOutputPath` and top-level `output/` directory concept

### What's New

#### Detection & Performance
- **MDX optimization**: Early-stop logic, model reuse, and configurable vocal start window with iterative expansion
- **Multi-entry gap info**: Multi-txt folders now track gap data independently per song, preventing cross-contamination
- **Type safety**: Fixed 56 Python type errors across codebase for better IDE support and reliability

#### GPU Acceleration
- Optional GPU Pack with automatic hardware/version detection, auto-recovery, and speed display
- Linux support with dynamic PyTorch/torchaudio compatibility

#### Watch Mode (Real-time Monitoring)
- OS-native filesystem watchers (ReadDirectoryChangesW/FSEvents/inotify) for efficient monitoring
- Automatic discovery of new songs, smart updates on file changes, and cache synchronization
- Debouncing (500ms default) prevents processing storms; configurable via `[WatchMode]` section

#### UI & UX Improvements
- **Performance**: Viewport-based lazy loading and instant task lane architecture for responsive UI
- **Waveform markers**: Dynamic overlay markers (playhead, detected gap, original gap) instead of baked-in PNG graphics
- **Layout**: Song action buttons repositioned below song list; improved visual hierarchy
- **Persistence**: Window size/position saved; log viewer with horizontal scroll

#### Developer & CI/CD
- **Testing**: 516 cross-platform tests with tier-3 pipeline integration and expanded gap detection scenarios
- **CI/CD**: GitHub Actions with automated multi-platform builds (Windows/Linux/macOS), Qt/PySide6 dependencies, Windows-only test auto-skipping
- **Code quality**: .gitattributes for line ending normalization (Windows↔Linux compatibility), complexity analysis, type checking
- **Build**: Cleaned up duplicate workflows, pinned torch/torchaudio <2.5 for API compatibility, added torchcodec dependency
- **Codebase**: Major refactors with strategy patterns, removed feature flags, unified code paths, renamed `types.py` to `result_types.py` to avoid stdlib shadowing

#### Bug Fixes
- **Audio normalization**: Fixed WinError 5 "Access Denied" with multi-layer file lock prevention (retry logic, delays, unload signaling)
- **Config persistence**: Fixed config.ini reset during tests with lazy-loaded Config and automatic test mode detection
- **Waveform accuracy**: Removed dynaudnorm filter to preserve original amplitude for visual comparison
- **Status updates**: Fixed normalization status persistence, gap detection cache updates, and loading placeholder visibility
- **GPU Pack**: Improved compatibility (wheel structure, version detection, metadata validation)
- **Worker queue**: Enhanced error handling, QThread cleanup, cancellation support, and responsiveness
- **Cache versioning**: User prompt on first launch after upgrade to confirm re-scan; automatic cache rebuilding

### Upgrading from v1.0.0

1. Pull latest code.
2. On Windows, run: .\run.bat install
3. On Linux/macOS, run: ./run.sh install
4. (Optional) Remove old conda env after successful migration.
5. Alternatively, download prebuilt binaries from the Releases page.

**Finding your data directory:**

- Windows: Press Win+R, type %LOCALAPPDATA%\USDXFixGap, press Enter
- Linux: ~/.local/share/USDXFixGap/
- macOS: ~/Library/Application Support/USDXFixGap/

### FAQs

**How do I enable GPU acceleration?**

Use .\run.bat install --gpu on Windows or ./run.sh install --gpu on Linux. The app auto-detects NVIDIA hardware and installs the correct wheels. Offline ZIP installation is supported.

**Do I need to migrate my settings?**

No action is required. The app creates a fresh config in the new data directory on first run. If you want to keep previous settings, copy config.ini (and optionally cache.db) from the old app directory to the new location.

### 🙏 Thanks

Thanks to all contributors and users for feedback, testing, and reports.
