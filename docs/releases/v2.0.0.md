# Release Notes v2.0.0

**Release Date:** October 2025  
**Status:** Major Release

---

## ‚ö†Ô∏è BREAKING CHANGES

### 1. Python Environment Migration (Conda ‚Üí Venv)

**USDXFixGap now uses standard Python virtual environments instead of Anaconda/Miniconda.**

**What changed:**
- ‚ùå **No longer requires** Anaconda or Miniconda
- ‚úÖ **Now uses** system Python 3.8+ with project-local `.venv`
- ‚úÖ **Same commands** - `run.bat`/`run.sh` work exactly as before
- ‚úÖ **Automatic setup** - Creates `.venv` on first run

**Migration steps:**
```bash
# Windows
git pull
.\run.bat install

# Linux/macOS
git pull
./run.sh install
```

**Benefits:**
- 6x faster environment creation (~10s vs 60s)
- Simpler setup (no separate Anaconda install)
- Better IDE integration (VS Code, PyCharm auto-detect)
- Smaller disk footprint (~500 MB vs 2-3 GB)

**See:** [Migration Guide](../VENV_MIGRATION.md)

---

### 2. Spleeter Detection Method Removed

**The legacy Spleeter and HQ Segment detection methods have been removed.**

**What changed:**
- ‚ùå **Removed:** `spleeter` detection method
- ‚ùå **Removed:** `hq_segment` detection method  
- ‚úÖ **Only MDX (Demucs)** is now supported
- ‚úÖ **Python 3.12+** now fully supported (was blocked by spleeter)

**Impact:**
- Existing configs with `method = spleeter` or `method = hq_segment` will automatically use MDX with a warning
- No user action required - graceful fallback

**Why this change:**
- Spleeter blocked Python 3.12+ support (dependency constraint)
- MDX is 5-10x faster with better accuracy
- Simpler codebase with single, well-tested method

**See:** [Spleeter Removal Details](../SPLEETER_REMOVAL.md)

---

### 3. Storage Location Changed (from v1.1.0)

**Your data will be in a new location:**

- **Windows**: `%LOCALAPPDATA%\USDXFixGap\` (was: app directory)
- **Linux**: `~/.local/share/USDXFixGap/` (follows XDG standard)
- **macOS**: `~/Library/Application Support/USDXFixGap/`

**What you need to know:**
- ‚úÖ The app creates new config automatically on first run
- ‚úÖ Old data stays in app directory (not deleted)
- ‚úÖ Optional: Manually copy `config.ini` if you want to keep settings
- ‚úÖ AI models will re-download to new location (~390 MB)

**Why this change:**
- Better multi-user support
- Update-safe storage (your data survives app updates)
- Follows OS conventions and standards

**See v1.1.0 release notes for detailed migration instructions.**

---

## üéâ Major Features

### 1. Python 3.12+ Support

**Full compatibility with modern Python versions:**
- ‚úÖ **Python 3.8-3.12+** now supported (previously limited to 3.8-3.11)
- ‚úÖ **Automatic version detection** in wrapper scripts
- ‚úÖ **Future-proof** - not tied to legacy dependencies

**Installation:**
```bash
# Windows - auto-detects Python 3.10/3.8/3+ via py launcher
.\run.bat install

# Linux/macOS - auto-detects python3.10/python3.8/python3
./run.sh install
```

---

### 2. Simplified Development Setup

**No more Anaconda/Miniconda required:**

**Before (v1.x):**
```bash
# Required separate Anaconda/Miniconda installation
conda create -n usdxfixgapgui python=3.8
conda activate usdxfixgapgui
pip install -r requirements.txt
```

**After (v2.0):**
```bash
# Uses system Python - auto-creates .venv on first run
.\run.bat install    # Windows
./run.sh install     # Linux/macOS
```

**Benefits:**
- Faster bootstrap (~10s vs 60s+)
- Simpler installation (one less requirement)
- Better IDE integration
- Consistent behavior across platforms

---

### 3. MDX-Only Detection (from v1.1.0)

**Streamlined to single, superior detection method:**

MDX (Demucs-based) detection provides:
- **5-10x faster** than previous methods
- **More accurate** onset detection using Meta's Demucs AI
- **Smart chunked scanning** - processes only what's needed
- **Energy-based detection** with adaptive thresholds
- **SNR confidence scoring** - know how reliable each detection is

**Performance:**
- **GPU**: 10-30 seconds per song (with optional GPU Pack)
- **CPU**: 30-60 seconds per song

**See v1.1.0 release notes for full MDX feature details.**

---

## ‚ú® New Features & Improvements

### Environment & Setup

- **Automatic venv creation** - No manual environment setup needed
- **Python version detection** - Auto-selects compatible Python (3.10 ‚Üí 3.8 ‚Üí 3+)
- **Explicit executable paths** - No shell activation required (deterministic execution)
- **PowerShell compatibility** - Added syntax hints for Windows PowerShell users (`.\run.bat`)

### Detection & Processing (from v1.1.0)

- **MDX provider** - Fast, accurate vocal onset detection (now only method)
- **GPU acceleration** - Optional NVIDIA CUDA support on Windows and Linux
- **Cross-platform GPU Pack** - Automated installation on both platforms
- **Confidence scoring** - SNR-based reliability metrics
- **Smart caching** - Reuses separated vocals for confidence computation
- **Early exit optimization** - Stops processing as soon as onset found

### Configuration & Storage (from v1.1.0)

- **Cross-platform paths** - Windows/Linux/macOS support with OS conventions
- **Configurable model storage** - Set custom locations for AI models
- **Unified data directory** - Everything in one place
- **Environment variable expansion** - Support for dynamic paths

### Code Quality & Reliability

- **Thread-safe model cache** - Safe concurrent access with locking
- **LRU cache with bounds** - Prevents memory leaks (max 6 vocals cached)
- **Empty array guards** - Prevents crashes on edge cases
- **Centralized configuration** - `MdxConfig` dataclass with validation
- **Eliminated magic numbers** - Module constants for maintainability

---

## üêõ Bug Fixes

### Critical Fixes (from v1.1.0)

- **Fixed crash on songs without intro**: Songs with vocals starting immediately no longer fail detection
  - Returns `gap=0` instead of throwing exception
  - Affects songs like "101 Dalmatiner - Cruella De Vil"
- **Fixed runtime crashes** from missing error signal connections
- **Fixed status update** after audio normalization
- **Fixed duration N/A** display issue in UI

### Environment & Compatibility

- **Fixed Python 3.12+ compatibility** - Removed spleeter dependency blocking
- **Fixed venv bootstrap** on systems with multiple Python versions
- **Fixed GPU detection** on fresh installations
- **Fixed Windows PowerShell syntax** in documentation

### Detection & Processing (from v1.1.0)

- Fixed onset accuracy in provider semantics
- Improved silence period detection
- Better handling of edge cases
- Suppressed harmless TorchAudio MP3 warnings for cleaner console output

### System Fixes (from v1.1.0)

- **Windows**: Fixed `CREATE_NO_WINDOW` subprocess issue
- **Caching**: Fixed storing duration in cache database
- **Import errors**: Fixed wrong import statements

---

## üîÑ Changes & Removals

### Removed

- ‚ùå **Spleeter dependency** - Blocked Python 3.12+, slower than MDX
- ‚ùå **Spleeter detection provider** - Full-track separation method
- ‚ùå **HQ Segment detection provider** - Windowed Spleeter wrapper
- ‚ùå **Conda environment requirement** - Now uses standard venv
- ‚ùå **spleeter-env directory** - No longer created

### Changed

- **Python requirement**: Python 3.8+ (was: Python 3.8-3.11, now includes 3.12+)
- **Default detection method**: MDX only (was: MDX/Spleeter/HQ Segment)
- **Environment location**: `.venv` in project root (was: conda env in `~/anaconda3/envs/`)
- **Bootstrap speed**: ~10 seconds (was: ~60 seconds with conda)
- **Storage location**: Platform-standard paths (from v1.1.0, see Breaking Changes)

### Architecture Improvements

- **Provider architecture** - Single MDX provider with graceful fallback
- **Configuration structure** - `MdxConfig` dataclass with validation
- **Model cache** - Thread-safe with LRU eviction
- **Wrapper scripts** - Explicit executable paths, no shell activation
- **Documentation** - Comprehensive migration guides added

---

## üìö Documentation

### New Documentation

1. **[VENV_MIGRATION.md](../VENV_MIGRATION.md)** - Comprehensive conda‚Üívenv migration guide
2. **[MIGRATION_QUICKSTART.md](../MIGRATION_QUICKSTART.md)** - Quick reference for migration
3. **[PYTHON_VERSION_COMPATIBILITY.md](../PYTHON_VERSION_COMPATIBILITY.md)** - Python version support details (updated for 3.12+)
4. **[SPLEETER_REMOVAL.md](../SPLEETER_REMOVAL.md)** - Spleeter removal details and rationale
5. **[IMPLEMENTATION_SUMMARY.md](../IMPLEMENTATION_SUMMARY.md)** - Technical implementation details
6. **[MIGRATION_COMPLETE.md](../MIGRATION_COMPLETE.md)** - Migration completion summary

### Updated Documentation

- **README.MD** - Updated setup instructions for venv
- **.github/copilot-instructions.md** - Updated development workflow, added PowerShell syntax
- **docs/architecture.md** - Updated to reflect MDX-only architecture
- **docs/gpu-acceleration.md** - Cross-platform GPU Pack support (from v1.1.0)

---

## üîÑ Upgrading from v1.x

### Quick Upgrade (Recommended)

```bash
# Windows PowerShell
git pull
Remove-Item -Recurse -Force .venv  # Remove old environment if exists
.\run.bat install
.\run.bat test

# Linux/macOS
git pull
rm -rf .venv  # Remove old environment if exists
./run.sh install
./run.sh test
```

### What Happens Automatically

1. ‚úÖ **Venv creation** - `.venv` created on first `run.bat`/`run.sh` execution
2. ‚úÖ **Dependencies installed** - All packages installed automatically
3. ‚úÖ **GPU detection** - Automatically detects NVIDIA GPU and installs CUDA wheels if present
4. ‚úÖ **Config migration** - Existing `config.ini` with `method=spleeter` automatically uses MDX

### Optional: Remove Old Conda Environment

```bash
# After successful migration, optionally remove old conda environment
conda env remove -n usdxfixgapgui
```

### Detailed Migration Guide

See [VENV_MIGRATION.md](../VENV_MIGRATION.md) for:
- Step-by-step instructions
- Troubleshooting
- Python version selection
- GPU installation
- Validation steps

---

## üéØ Command Reference

All commands remain **unchanged** (same UX):

```bash
# Application
.\run.bat start             # Start USDXFixGap
.\run.bat test              # Run tests

# Environment
.\run.bat install           # Install/update deps (auto-detect GPU)
.\run.bat install --gpu     # Force GPU installation
.\run.bat install --cpu     # Force CPU installation
.\run.bat install-dev       # Install dev dependencies

# Development
.\run.bat clean             # Clean cache
.\run.bat shell             # Interactive Python shell
.\run.bat info              # Show environment info
.\run.bat analyze [mode]    # Code quality analysis
.\run.bat cleanup [mode]    # Code cleanup
```

**Note:** Replace `.\run.bat` with `./run.sh` on Linux/macOS. Windows PowerShell users must use `.\run.bat` syntax (the `.\` prefix is required).

---

## üêõ Known Issues

**None currently!** 

Both venv migration and spleeter removal have been thoroughly tested on Windows/Linux/macOS with Python 3.8-3.12+.

**Reporting Issues:**
Please report bugs on [GitHub Issues](https://github.com/vtietz/usdxfixgapgui/issues)

---

## üìä Performance Comparison

### Environment Setup

| Metric | v1.x (Conda) | v2.0 (Venv) | Improvement |
|--------|-------------|------------|-------------|
| **Setup Time** | ~60 seconds | ~10 seconds | ‚úÖ 6x faster |
| **Disk Space** | ~2-3 GB | ~500 MB | ‚úÖ 4-6x smaller |
| **Requirements** | Anaconda/Miniconda | System Python | ‚úÖ Simpler |
| **IDE Integration** | Manual setup | Auto-detect | ‚úÖ Better |

### Detection Speed (from v1.1.0)

| Method | Performance | Accuracy | Status |
|--------|-------------|----------|--------|
| **MDX (GPU)** | 10-30s | Excellent | ‚úÖ Only method |
| **MDX (CPU)** | 30-60s | Excellent | ‚úÖ Only method |
| ~~Spleeter~~ | ~~30-90s~~ | ~~Good~~ | ‚ùå Removed |
| ~~HQ Segment~~ | ~~15-45s~~ | ~~Very Good~~ | ‚ùå Removed |

---

## üôè Acknowledgments

- **Meta AI Research** - For Demucs vocal separation model
- **Python Software Foundation** - For venv standard library
- **GitHub Copilot** - For migration assistance and code reviews

---

## üì¶ Technical Details

### System Requirements

**Python:**
- ‚úÖ Python 3.8+ (3.10 recommended)
- ‚úÖ Python 3.12+ now fully supported

**Operating Systems:**
- ‚úÖ Windows 10/11
- ‚úÖ Ubuntu 22.04+ / Debian 11+
- ‚úÖ macOS 12+

**Optional:**
- NVIDIA GPU with CUDA support for 5-10x faster processing
- GPU Pack download: ~2.8 GB (automated via `run.bat install --gpu`)

### Dependencies

**Core:**
- PySide6 6.6.x - Qt for Python GUI
- librosa 0.10.1 - Audio analysis
- demucs 4.0.1 - AI vocal separation (MDX)
- numpy 1.24.x - Numerical computing
- scipy ‚â•1.10 - Scientific computing
- torch ‚â•2.0.0 - PyTorch deep learning
- torchaudio ‚â•2.0.0 - Audio processing

**Removed:**
- ~~spleeter 2.4.0~~ - Removed (blocked Python 3.12+)

### Installation Size

- **Base install (CPU)**: ~500 MB
- **With GPU Pack**: ~3.3 GB total
- **AI models**: ~390 MB (Demucs MDX)

---

## üîó Links

- **GitHub**: https://github.com/vtietz/usdxfixgapgui
- **Issues**: https://github.com/vtietz/usdxfixgapgui/issues
- **v1.1.0 Release**: [docs/releases/v1.1.0.md](./v1.1.0.md)

---

## üìù Changelog Summary

**BREAKING CHANGES:**
- Migrated from conda to venv (requires new setup)
- Removed Spleeter/HQ Segment detection methods (MDX only)
- Storage location changed to platform-standard paths (from v1.1.0)

**ADDED:**
- Python 3.12+ support
- Automatic venv creation and bootstrap
- Explicit executable path execution (no shell activation)
- PowerShell syntax documentation
- Comprehensive migration guides

**REMOVED:**
- Spleeter dependency and detection provider
- HQ Segment detection provider
- Conda environment requirement

**FIXED:**
- Python 3.12+ compatibility
- Environment setup complexity
- GPU detection on fresh installs
- Cross-platform consistency

**CHANGED:**
- Python requirement: 3.8+ (now includes 3.12+)
- Environment location: `.venv` in project root
- Bootstrap speed: 6x faster (~10s vs 60s)
- Default detection: MDX only (Spleeter/HQ Segment removed)

---

**Release Date:** October 2025  
**Version:** 2.0.0  
**Status:** ‚úÖ Complete

**Migration Status:** Ready for production  
**Tested On:** Windows 10/11, Ubuntu 22.04, macOS 12+  
**Python Versions:** 3.8, 3.9, 3.10, 3.11, 3.12+
