"""
Type definitions for gap detection results and provider outputs.

This module contains dataclasses that standardize result formats across
the detection pipeline, improving type safety and documentation.
"""

from dataclasses import dataclass, field
from typing import List, Tuple, Optional


@dataclass
class DetectionProviderResult:
    """
    Result from detection provider operations.

    This encapsulates all outputs from a provider's detection process,
    including the detected gap position, silence/speech segments, file paths,
    and quality metrics.

    Attributes:
        detected_gap: Detected gap position in milliseconds (integer)
        silence_periods: List of (start_ms, end_ms) tuples for silence regions
        vocals_file: Path to vocals/preview audio file generated by provider
        confidence: Detection confidence score (0.0-1.0), None if unavailable
        detection_method: Provider identifier ('mdx' only)
        preview_wav_path: Path to preview audio snippet for waveform visualization
        waveform_json_path: Path to waveform JSON data for UI display
        detected_gap_ms: Detected gap as float milliseconds (for precision)
        first_note_ms: Position of first note in milliseconds (from USDX file)
    """
    detected_gap: Optional[int] = None
    silence_periods: List[Tuple[float, float]] = field(default_factory=list)
    vocals_file: Optional[str] = None
    confidence: Optional[float] = None
    detection_method: str = "unknown"
    preview_wav_path: Optional[str] = None
    waveform_json_path: Optional[str] = None
    detected_gap_ms: Optional[float] = None
    first_note_ms: Optional[float] = None


@dataclass
class DetectGapResult:
    """
    Results of complete gap detection workflow.

    This is returned by the top-level detect_gap.perform() function and includes
    all provider results plus additional orchestration metadata like waveform paths.

    Attributes:
        detected_gap: Detected gap position in milliseconds (integer)
        silence_periods: List of (start_ms, end_ms) tuples for silence/speech regions
        vocals_file: Path to vocals/preview audio file
        confidence: Detection confidence score (0.0-1.0), None if unavailable
        detection_method: Provider identifier that was used
        preview_wav_path: Path to preview audio snippet
        waveform_json_path: Path to waveform JSON data
        detected_gap_ms: Detected gap as float milliseconds
    """
    detected_gap: int
    silence_periods: List[Tuple[float, float]]
    vocals_file: str
    confidence: Optional[float] = None
    detection_method: str = "unknown"
    preview_wav_path: Optional[str] = None
    waveform_json_path: Optional[str] = None
    detected_gap_ms: Optional[float] = None